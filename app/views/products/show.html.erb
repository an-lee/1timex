<div class="container">
  <div class="col-sm-8">
    <main>
      <div class="item-details">
        <div class="item-title">
          <h2 style="text-align:center;"><%= @product.title %></h2>
          <p style="text-align:center;"><%= @product.description %></p>
        </div>
        <!-- nav-tabs -->
      <ul class="nav nav-tabs nav-justified">
          <li class="active"><a data-toggle="tab" href="#product">产品</a></li>
          <li><a data-toggle="tab" href="#review">评测</a></li>
          <li><a data-toggle="tab" href="#post">讨论</a></li>
        </ul>
      </div>
      <!-- .nav-tabs-->

      <!-- tab-content -->
      <div class="tab-content content-sm">
        <div id="product" class="tab-pane fade in active">
          <div>
            <% if @product.image.present? %>
              <%= image_tag(@product.image.medium.url, class:"thumbnail") %>
            <% else %>
              <%= image_tag("http://placehold.it/400x400&text=No Pic", class:"thumbnail") %>
            <% end %>
          </div>
        </div>
        <div id="review" class="tab-pane fade">
          <%= link_to("Write a Post", new_product_post_path(@product), class: "btn btn-primary")%>
          <div class="review">
            <% @reviews.each do |review| %>
              <h1><%= link_to(review.title, product_review_path(review.product, review)) %></h1>
              <p>评测人：<%= review.user.email %></p>
              <p>发表时间：<%= review.created_at %></p>
              <hr>
              <p><%= markdown(review.body) %></p>

              <% if current_user && current_user == review.user %>
                <%= link_to('Edit', edit_product_review_path(review.product, review), class: "btn btn-default btn-xs pull-right") %>
                <%= link_to('Delete', product_review_path(review.product, review), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-default btn-xs pull-right") %>
              <% end %>
            <% end %>
          </div>
          <!-- <p>暂无评测</p> -->
          <div class="text-center">
            <%= will_paginate @reviews %>
          </div>
        </div>
        <div id="post" class="tab-pane fade">
          <table class="table">
            <thead>
              <tr>
                <th>文章内容</th>
                <th>发表者</th>
                <th>发表时间</th>
              </tr>
            </thead>
            <tbody>
              <% @posts.each do |post| %>
                <tr>
                  <td><%= post.content %></td>
                  <td><%= post.user.email %></td>
                  <td><%= post.created_at %></td>
                  <% if current_user && current_user == post.user %>
                    <td><%= link_to('Edit', edit_product_post_path(post.product, post), class: "btn btn-default btn-xs") %></td>
                    <td> <%= link_to('Delete', product_post_path(post.product, post), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-default btn-xs") %></td>
                  <% end %>
                </tr>
              <% end %>
            </tbody>
          </table>

          <div class="text-center">
            <%= will_paginate @posts %>
          </div>
        </div>

      </div>

    </main>
  </div>

  <div class="col-md-3 col-md-offset-1 col-sm-4 padding-bottom-2x">
    <aside>

      <div style="height:100px;">

      </div>
      <b>
        库存: <%= @product.quantity %>
      </b>
      <div class="item-price">
        ¥ <%= @product.price %>
      </div>
      <div>
        <% if @product.quantity.present? && @product.quantity > 0 %>
          <%= link_to("Add into Cart", add_to_cart_product_path(@product), :method => :post, :class => "btn btn-primary btn-lg btn-danger") %>
        <% else %>
          <div class="btn btn-danger">
            Sold Out
          </div>
        <% end %>
      </div>
    </aside>
  </div>

</div>
